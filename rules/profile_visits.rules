/// üëÅÔ∏è Cole√ß√£o de visitas ao perfil (root level para suporte TTL)
/// Path: ProfileVisits/{visitId}
/// 
/// Estrutura:
/// - visitedUserId: string (quem recebeu a visita)
/// - visitorId: string (quem visitou)
/// - visitedAt: timestamp
/// - visitCount: number (incrementa em visitas repetidas)
/// - expireAt: timestamp (TTL - 7 dias)
/// - source: string ('profile', 'event', etc)

match /ProfileVisits/{visitId} {
  // Qualquer usu√°rio autenticado pode ler suas pr√≥prias visitas
  allow read: if isSignedIn() && 
                 request.auth.uid == resource.data.visitedUserId;
  
  // Qualquer usu√°rio autenticado pode registrar visitas
  allow create, update: if isSignedIn();
  
  // Apenas o dono pode deletar suas visitas
  allow delete: if isSignedIn() && 
                   request.auth.uid == resource.data.visitedUserId;
}

/// üëÅÔ∏è Cole√ß√£o de views agregadas (para notifica√ß√µes)
/// Path: ProfileViews/{viewId}
match /ProfileViews/{viewId} {
  // Qualquer usu√°rio autenticado pode registrar views
  allow create: if isSignedIn();
  
  // Apenas o dono do perfil visualizado pode ler
  allow read: if isSignedIn() && 
                 request.auth.uid == resource.data.viewedUserId;
}
